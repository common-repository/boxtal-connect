"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e={};e.ratesTable={trigger:"#bw-rates-table",init:function(){var e=document.querySelector(this.trigger),t=this;null!==e&&(t.on("body","click",".bw-add-rate-line",function(e){e.preventDefault();var n=new XMLHttpRequest;n.onreadystatechange=function(e){if(4===n.readyState)if(200===n.status){var r="object"===_typeof(n.response)&&null!==n.response?n.response.data:JSON.parse(n.response).data;t.getTableBody().insertAdjacentHTML("beforeend",r),t.initSelect("#bw-rates-table tbody tr:last-child select.bw-tom-select")}else console.log("Error: "+n.status)},n.open("POST",bwData.ajaxurl),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json";var r="action="+e.target.getAttribute("data-action")+"&security="+encodeURIComponent(bwData.shippingMethodAjaxNonce),o=t.getTableRows();if(null!==o){var l=o[o.length-1],i=[];t.parseNodeChildrenSpecificTypeAction(l,["SELECT","INPUT"],function(e){if("SELECT"===e.tagName){var n=e.getAttribute("name"),r=t.getSelectedOptions(e);r.length>0?r.map(function(e){i.push(n+"="+encodeURIComponent(e.value))}):i.push(n+"=")}else i.push(e.getAttribute("name")+"="+encodeURIComponent(e.value))}),r+="&"+i.join("&")}n.send(r)}),t.on("body","click",".bw-remove-rate-line",function(e){e.preventDefault();var t=document.querySelector(".pricing-item.last_selected");null!==t&&t.remove()}),t.on("body","click",".bw-remove-line",function(e){e.preventDefault();var n=t.getParentRow(e.target);null!==n&&n.remove()}),t.on("body","change",".bw-change-state",function(e,n){var r=null!==e.target&&!1===e.target.checked,o=t.getParentRow(e.target);null!==o&&t.setRowState(o,r)}),t.initSelect("select.bw-tom-select"),t.submitForm=t.submitForm.bind(t),document.getElementById("mainform").addEventListener("submit",t.submitForm))},getParentRow:function(e){for(;null!==e&&e!==undefined&&"tr"!==e.tagName.toLowerCase();)e=e.parentNode;return e===undefined?null:e},setRowState:function(e,t){var n=e.querySelectorAll('input[type="text"], input[type="number"], select'),r=!0,o=!1,l=undefined;try{for(var i,a=n[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){i.value.disabled=t}}catch(u){o=!0,l=u}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw l}}this.initSelect("#bw-rates-table select.bw-tom-select"),t?e.classList.add("disabled"):e.classList.remove("disabled")},getSelectedOptions:function(e,t){for(var n,r=[],o=0,l=e.options.length;o<l;o++)(n=e.options[o]).selected&&(r.push(n),t&&t(n));return r},submitForm:function(e){e.preventDefault();var t=[],n=document.querySelectorAll(".pricing-item");if(n.length>0)for(var r=0;r<n.length;r++){var o=n[r],l=o.querySelector("td .state"),i=l.checked?l.getAttribute("data-checked"):l.getAttribute("data-unchecked"),a=o.querySelector("td .shipping-class"),u={"price-from":o.querySelector("td .price-from").value,"price-to":o.querySelector("td .price-to").value,"weight-from":o.querySelector("td .weight-from").value,"weight-to":o.querySelector("td .weight-to").value,"shipping-class":null===a?[]:Array.apply(null,a.options).filter(function(e){return e.selected}).map(function(e){return e.value}),"parcel-point-network":Array.apply(null,o.querySelector("td .parcel-point-network").options).filter(function(e){return e.selected}).map(function(e){return e.value}),pricing:i,"flat-rate":o.querySelector("td .flat-rate").value,state:o.querySelector("td .state").checked};t.push(u)}var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","pricing-items"),c.value=JSON.stringify(t);var s=document.createElement("input");return s.setAttribute("type","hidden"),s.setAttribute("name","save"),s.value=1,document.querySelector(this.trigger).appendChild(c),document.querySelector(this.trigger).appendChild(s),document.getElementById("mainform").removeEventListener("submit",this.submitForm),document.getElementById("mainform").submit(),!0},initSelect:function(e){for(var t=document.querySelectorAll(e),n=0;n<t.length;n++){var r=t[n];r.tomselect?r.disabled?r.tomselect.disable():r.tomselect.enable():new TomSelect(t[n],{plugins:["remove_button"]})}},getTableBody:function(){var e=document.querySelector(this.trigger).querySelector("tbody");return null===e?null:e},getTableRows:function(){var e=this.getTableBody();return null===e?null:0===e.childElementCount?null:e.children},parseNodeChildrenSpecificTypeAction:function(e,t,n){if(e.hasChildNodes())for(var r=e.childNodes,o=0;o<r.length;o++){var l=r[o];-1!==t.indexOf(l.tagName)&&n(l),this.parseNodeChildrenSpecificTypeAction(l,t,n)}return e},on:function(e,t,n,r){var o=document.querySelector(e);o.addEventListener(t,function(e){for(var t=o.querySelectorAll(n),l=e.target,i=0,a=t.length;i<a;i++)for(var u=l,c=t[i];u&&u!==o;){if(u===c)return r.call(c,e);u=u.parentNode}})}},document.addEventListener("DOMContentLoaded",function(){e.ratesTable.init()})}();